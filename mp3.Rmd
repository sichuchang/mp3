---
title: "A Study on Genre Multiplicity"
author: "Chujun He, Sichu Chang, Yining Hua"
output: html_document
---
```{r, include=FALSE}
library(tidyverse)
library(mdsr)
library(RMySQL)
library(ggplot2)
```

In this project, we are trying to figure out the changes in flim genres over years and their possible historical influential factors, which is the second question of the problem set.

```{r,message=FALSE}
db <- dbConnect_scidb(dbname = "imdb")
#a smaller table, years before 2017
#Since some data is missing from 2018 to 2115, we filter out these years' data
film_before_2017<-db %>%
  dbGetQuery("SELECT t.id, t.title, t.production_year,
             mi.info as info
             FROM title t
             Join movie_info as mi on mi.movie_id = t.id
             where info_type_id = 3
             and production_year <= 2017
             having production_year IS NOT NULL;")
```

Q:Is is true that older movies tended to fit squarely in one genre, while more recent movies tend to span multiple genres?

```{r,message=FALSE}
#Find each film has how many genres in each year from 1874 to 2017
film_genre = film_before_2017%>%
   group_by(id,production_year)%>%
   summarise(sum_genre = n_distinct(info))%>%
   arrange(production_year)
```

```{r,message=FALSE}
# we define the film with more than 3 genres as the film with multilple genres and 
# find out how many films has more than 3 genres in each year from 1874 to 2017
multi_genre_film = 
  film_genre %>% 
  filter(sum_genre >= 3) %>% #want the films with overlapping genres (more than 3)
  group_by(production_year) %>% 
  summarise(multi_num = n_distinct(id))
```

```{r,message=FALSE}
# how many films each year
total_genre = 
  film_genre %>% 
  group_by(production_year) %>% 
  summarise(total_num = n_distinct(id))
```


```{r,message=FALSE}
#percentages of multi_genres film each year
join_total_multi = 
  total_genre %>% left_join(multi_genre_film, by ='production_year') %>%
  mutate(multi_num_new = ifelse(is.na(multi_num),0,multi_num)) %>%
  mutate(multi_percent = multi_num_new/total_num)
```

```{r,message=FALSE}
multi_plot = ggplot(join_total_multi,aes(x=production_year,y=multi_percent))+
  geom_line()+
  geom_smooth()+
  scale_y_continuous(labels = scales::percent)+
  labs(y= 'Percent of Multi-genre Films', x = 'Production Year')+
  theme_minimal()

multi_plot
```

From the graph, we can see that the percentage of movies that have multi-genres increaseed from 1900 to 1940, and then it kept decreasing till 2000. 
Overall, it is true that movies made today tend to have overlapping genres than before. Also, it seems that the 1947 court decision that broke up the vertical integretion of studios has contributed to the decrease of overlapping genres.

**The possible causes for dramatic increase in the total amount of films and their genres from 2003 might be:**
2003:Hollywood action film star Arnold Schwarzenegger was elected the 38th governor of California. Therefore the film industry might be greatly encouraged.

Then new easy ways for advertising and propogating new films emerge continuously:
2004: Facebook launched. 

2005: The first YouTube video was uploaded to YouTube.com in late spring.

2005: The action sequel Charlie's Angels: Full Throttle (2003), the first Sony Pictures film, was also the first feature film to be released on Blu-Ray Disc, a next generation, high-definition optical disc format. 

2006: The social networking and blogging site Twitter was founded and debuted.

2007: Netflix became the first subscription service to offer ad-free, legal video streaming of movies directly onto oneâ€™s computer screen.

(Retrieved from http://www.filmsite.org/2000sintro.html)


```{r,message=FALSE}
#How many different genres appear in each year from 1874 to 2017 
info_type_year = film_before_2017%>%
  group_by(production_year)%>%
  summarise(sum = n_distinct(info))%>% #how many different genres each year
  arrange(production_year)
```

```{r,message=FALSE}
#A graph of genres overyears
genre_oyG = info_type_year%>%
  ggplot(aes(x = production_year,y = sum))+
    geom_line()+
    labs(y= 'Number of Genres', x = 'Production Year')+
  theme_minimal()
genre_oyG
```

```{r,message=FALSE}
#A graph of total films made overyear
film_oyG = film_before_2017%>%
  group_by(production_year)%>%
  summarize(sum_films = n())%>%
  ggplot(aes(x = production_year,y = sum_films))+
  labs(y= 'Number of Films', x = 'Production Year')+
    geom_line() +
    theme_minimal()
film_oyG
```

From the 2 graphs above we can see that the number of genre types had a big increase from 1890 to 1910. The total amount of films had an increase accordingly during this period of time, but it soon decreased in around 1910-1920, mighty because of World War I. The amount of films didn't reach the amount once reached in around 1903 untill around 1995. However WW1 didn't decrease the genres of films made, but increased them.

```{r,message=FALSE}
db <- dbConnect_scidb(dbname = "imdb")
#focus on horror films
horror_before_2017<-db %>%
  dbGetQuery("SELECT t.id, t.title, t.production_year,
              mi.info as info
              FROM title t
              Join movie_info as mi on mi.movie_id = t.id
              where info_type_id = 3 
              and production_year <= 2017
              and info like '%Horror%'
              having production_year is not null;")
```


